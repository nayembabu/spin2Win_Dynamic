function Spin2WinWheel(){var r=this,C=document.querySelector(".wheelSVG"),f=document.querySelector(".wheel"),R=document.querySelector(".wheelOutline"),J=document.querySelector(".peg"),ca=document.querySelector(".pegContainer"),ya=document.querySelector(".mainContainer"),D=document.querySelector(".valueContainer"),da=document.querySelector(".centerCircle"),q=document.querySelector(".toast"),ea=document.querySelector(".toast p"),b,S,fa,T,n,ga,ha,ia,ja,K,k,t,ka,la,ma,na,oa,pa,U,u,w,A,m,qa,L,p=0,g,h,
E,c=0,F=2,M=0,G=0,V=G,W=[],ra,sa,X,Y,N,ta,ua,v,x=null,O,P,Q,Z,H=[],za=new Audio("media/wheel_tick.mp3"),l,B=!0,va=function(){TweenMax.set("svg",{visibility:"visible"});TweenMax.set(f,{svgOrigin:g+" "+h,x:0,y:0});TweenMax.set(J,{x:g-J.getBBox().width/2,y:h-n-J.getBBox().height/2,transformOrigin:"50% 25%",visibility:"visible"});TweenMax.set(ca,{transformOrigin:"50% 100%",scale:T/600});TweenMax.set(ya,{svgOrigin:g+" "+h,rotation:-90,x:0,y:0});TweenMax.set([q],{xPercent:-50,left:"50%",top:"50%",yPercent:-50});
TweenMax.set("svg",{xPercent:-50,left:"50%",top:"50%",yPercent:-50})},Aa=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","g"),b=document.createElementNS("http://www.w3.org/2000/svg","circle");R.appendChild(a);b.setAttributeNS(null,"fill","transparent");b.setAttributeNS(null,"stroke",S);b.setAttributeNS(null,"stroke-width",fa);b.setAttributeNS(null,"cx",g);b.setAttributeNS(null,"cy",h);b.setAttributeNS(null,"r",n);a.appendChild(b);return a},Ba=function(){var a=document.createElementNS("http://www.w3.org/2000/svg",
"circle");a.setAttributeNS(null,"fill",ma);a.setAttributeNS(null,"stroke",ka);a.setAttributeNS(null,"stroke-width",la);a.setAttributeNS(null,"cx",g);a.setAttributeNS(null,"cy",h);a.setAttributeNS(null,"r",oa);return a},Ca=function(){za.play()},Da=function(){q.style.visibility="hidden"},Ea=function(){q.style.visibility="hidden";x.onclick=null;F+=2},Fa=function(){v||k[0].disable();B&&(Z=VelocityTracker.track(f,"rotation"))},aa=function(a){L=p;p=Math.round(f._gsTransform.rotation/m);p!=L&&TweenMax.fromTo(J,
.2,{rotation:p>L?-35:35},{onStart:ta?Ca:null,rotation:0,ease:Back.easeOut});TweenMax.set(D,{rotation:f._gsTransform.rotation})},Ga=function(){t=f._gsTransform.rotation;var a=Math.round(t%360),a=0<a?360-a:a,a=0>a?a*=-1:a;if(Z&&.5>=Z.getVelocity("rotation"))v||k[0].enable(),ba("invalidSpin");else{ba(Math.abs(Math.round(a/m)));if(B)if(-1<A)c++;else return;else c++,k[0].vars.snap=[l[c]];VelocityTracker.untrack(f);c>=A?wa():v||k[0].enable()}},Ha=function(a){return function(b){return Math.round(b/m)*m-
a}},xa=function(){k=Draggable.create(f,{type:"rotation",bounds:{minRotation:-1E16,maxRotation:0},throwProps:!0,ease:Back.easeOut.config(.2),snap:B?Ha(0):[l[c]],throwResistance:0,minDuration:ra,onThrowComplete:Ga,onPress:Da,onDrag:aa,onThrowUpdate:aa,overshootTolerance:1,onDragEnd:Fa})},I=function(){return function(){ThrowPropsPlugin.to(f,{throwProps:{rotation:{velocity:Math.floor(201*Math.random()+-700),end:B?-(m*Math.floor(Math.random()*(w-0+1)+0))-1080*F:[l[c]]}},onStart:Ea,onUpdate:aa,ease:Back.easeOut.config(.2),
overshootTolerance:0,onComplete:Ia})}},Ia=function(){t=f._gsTransform.rotation;var a=Math.round(t%360),a=0<a?360-a:a,a=0>a?a*=-1:a;ba(Math.abs(Math.round(a/m)));if(B)if(-1<A)c++;else return;else c++;c>=A?wa():x.onclick=I()},wa=function(){v||k[0].disable();TweenMax.set(C,{alpha:.3});TweenMax.to(ea,1,{text:sa,ease:Linear.easeNone,delay:2});P({gameId:N,target:r,results:H})},ba=function(a){v||k[0].applyBounds({minRotation:-1E16,maxRotation:t});"invalidSpin"==a?(TweenMax.set(f,{rotation:l[c]}),y(X),a=
{target:r,type:"error",spinCount:c,win:null,msg:X,gameId:N},Q(a),H.push(a)):isNaN(a)||(y(u[a].resultText),a={target:r,type:"result",spinCount:c,win:u[a].win,msg:u[a].resultText,gameId:N},O(a),H.push(a))},y=function(a){q.style.visibility="visible";q.style.backgroundColor="#E81D62";ea.innerHTML=a;TweenMax.fromTo(q,.6,{y:20,alpha:0},{y:0,alpha:1,delay:.2,ease:Elastic.easeOut.config(.7,.7)})};O=function(a){r.onResult(a)};Q=function(a){r.onError(a)};P=function(a){r.onGameEnd(a)};this.onResult=O;this.onError=
Q;this.onGameEnd=P;this.getGameProgress=function(){return H};this.init=function(a){if(a){C.setAttribute("viewBox","0 0 "+a.data.svgWidth+" "+a.data.svgHeight);b=a.data;P=a.onGameEnd?a.onGameEnd:r.onGameEnd;O=a.onResult?a.onResult:r.onResult;Q=a.onError?a.onError:r.onError;(x=a.spinTrigger?a.spinTrigger:null)&&(v=!0);v&&(x?x.onclick=I():f.onclick=I());S=b.wheelStrokeColor;T=b.wheelSize;n=T/2;ga=b.wheelTextColor;S=b.wheelStrokeColor;fa=b.wheelStrokeWidth;ha=b.wheelTextOffsetY;ia=b.wheelImageOffsetY;
K=b.wheelImageSize;ja=b.wheelTextSize;ka=b.centerCircleStrokeColor;la=b.centerCircleStrokeWidth;ma=b.centerCircleFillColor;na=b.centerCircleSize;oa=na/2;pa=b.segmentStrokeColor;U=b.segmentStrokeWidth;u=b.segmentValuesArray;w=u.length;A=-1==b.numSpins?1E16:b.numSpins;ra=b.minSpinDuration;sa=b.gameOverText;X=b.invalidSpinText;Y=b.introText;ta=b.hasSound;N=b.gameId;v=b.clickToSpin;m=360/w;qa=m/2;g=b.centerX;h=b.centerY;E=b.colorArray;ua=b.hasShadows;l=b.spinDestinationArray;ua&&(R.setAttributeNS(null,
"filter","url(#shadow)"),D.setAttributeNS(null,"filter","url(#shadow)"),da.setAttributeNS(null,"filter","url(#shadow)"),ca.setAttributeNS(null,"filter","url(#shadow)"),q.style.boxShadow="0px 0px 20px rgba(21,21,21,0.5)");va();for(var e,d,c,k,z,t,p=0;p<w;p++)G=-qa,V=G+m,a=g+n*Math.cos(Math.PI*G/180),d=h+n*Math.sin(Math.PI*G/180),e=g+n*Math.cos(Math.PI*V/180),c=h+n*Math.sin(Math.PI*V/180),k="M"+g+","+h+"  L"+a+","+d+"  A"+n+","+n+" 0 0,1 "+e+","+c+"z",t=document.createElementNS("http://www.w3.org/2000/svg",
"g"),z=document.createElementNS("http://www.w3.org/2000/svg","path"),t.appendChild(z),f.appendChild(t),TweenMax.set(z,{rotation:p*m,svgOrigin:g+" "+h}),z.setAttributeNS(null,"d",k),E[p]?k=E[p]:(k=E[M],M++,M==E.length&&(M=0)),z.setAttributeNS(null,"fill",k),z.setAttributeNS(null,"stroke",0),W.push({path:z,x1:a,x2:e,y1:d,y2:c});if(0<U)for(a=0;a<w;a++)e=document.createElementNS("http://www.w3.org/2000/svg","line"),e.setAttributeNS(null,"x1",g),e.setAttributeNS(null,"x2",W[a].x2),e.setAttributeNS(null,
"y1",h),e.setAttributeNS(null,"y2",W[a].y2),e.setAttributeNS(null,"stroke",pa),e.setAttributeNS(null,"stroke-width",U),f.appendChild(e),TweenMax.set(e,{svgOrigin:g+" "+h,rotation:a*m});for(a=0;a<w;a++)e=document.createElementNS("http://www.w3.org/2000/svg","g"),"image"==u[a].type?(d=document.createElementNS("http://www.w3.org/2000/svg","image"),e.appendChild(d),d.setAttribute("class","wheelImage"),d.setAttributeNS(null,"x",g-K/2),d.setAttributeNS(null,"y",h-n+ia),d.setAttributeNS(null,"width",K),
d.setAttributeNS(null,"height",K),d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u[a].value)):"string"==u[a].type&&(d=document.createElementNS("http://www.w3.org/2000/svg","text"),c=document.createTextNode(u[a].value),d.appendChild(c),e.appendChild(d),d.setAttribute("class","wheelText"),d.setAttributeNS(null,"fill",ga),d.setAttributeNS(null,"x",g),d.setAttributeNS(null,"y",h-n+ha),d.style.fontSize=ja),D.appendChild(e),TweenMax.set(e,{svgOrigin:g+" "+h,rotation:a*m});TweenMax.set(D,{svgOrigin:g+
" "+h});R.appendChild(Aa());da.appendChild(Ba());a:{if(0<l.length)for(B=!1,A=l.length,a=0;a<l.length;a++){if(l[a]>w||0===l[a]){y("Invalid destination set - please ensure the destination in spinDestinationArray is greater than 0 and less than or equal to the number of segments");TweenMax.set(C,{visibility:"hidden"});q.style.backgroundColor="red";break a}--l[a];l[a]=-1*l[a]*m-1080*F;F+=2}v?x?x.onclick=I():(x=f,f.onclick=I()):xa();y(Y)}1>=w&&(y("Not enough segments. Please add more entries to segmentValuesArray"),
TweenMax.set(C,{visibility:"hidden"}),q.style.backgroundColor="red")}else va(),y("PLEASE INCLUDE THE INIT OBJECT")};this.restart=function(){k[0].kill();q.style.visibility="hidden";c=0;F=2;H=[];p=L=null;TweenMax.set(C,{alpha:1});TweenMax.to([f,D],.3,{rotation:"0_short",onComplete:xa});y(Y)}};